# Mock Image Pipeline Using Apache Kafka

## *Note: After this application was finished, it was also successfully run unaltered on the Amazon Cloud. Now there is a separate new Amazon Cloud version in another repository on the same GitHub account. This new version was developed starting from the original non-cloud version. It utilizes the Amazon Cloud's relational database (RDS) and object storage (S3) services.*

## <u>Description</u>

This is a mock image processing pipeline using Apache Kafka. It was developed and run on a Linux Mint PC.

It "receives" images, stores them in a "database", analyzes them to detect image events of interest, stores image event descriptions and derivative images generated by the previous analysis in a "database," and alerts interested parties about them, storing records of the sent alerts in a "database."

It uses python Kafka clients to do the image processing work.  

There are also two standalone (non-Kafka) image event viewer options. The user enters an image event alert number to see the images associated with the image event. See the end of this document.

The mock aspects are:  

- The images are not received from an external source. They are generated by the image receiving client, starting with the original image in the *image_original/* subdirectory
- The image database is image files in a directory
- The image event database is image event description text files and associated analysis derivative images stored in a directory
- The image event alert database is image event alert description text files stored in a directory
- No image event alerts are actually sent



#### Some of the following commands are required to be executed in the application's main directory where its Python (*.py) files are.



### Build Apache Kafka Docker image and create a Docker container that automatically runs Apache Kafka

If you've already issued the below docker (pipeline) build/run commands for this project on your system, then you may first need to clean up your Docker environment:  

$ docker stop pipeline_container  
$ docker rm pipeline_container  
$ docker rmi pipeline_image

If you have run this mock application before, you should clear the data directories. You can empty the *image_\*/* directories (except for the image in *image_original/*, which you want to keep) using the following command:  

$ ./clean_image_dirs.sh  

Then build/run the docker image/container. Running the container automatically runs Apache Kafka.

$ docker build -t pipeline_image .  
$ docker run -v \<path where this application's code files are stored>:/pipeline --name pipeline_container -u="root" -p 9092:9092 pipeline_image

### <u>Open a command-line window, enter the container and run the image event alerting Kafka client</u>

Open a command-line window and enter the following commands:  

$ docker exec -it pipeline_container /bin/bash  
     (you will automatically be put in the  /pipeline directory of the container)  
$ python image_event_alert.py

### <u>Open a command-line window, enter the container and run the image analysis Kafka client</u>
Open a command-line window and enter the following commands:  

$ docker exec -it pipeline_container /bin/bash  
     (you will automatically be put in the  /pipeline directory of the container)  
$ python image_analysis.py

### <u>Open a command-line window, enter the container and run the image receiving Kafka client</u>
Open a command-line window and enter the following commands:  

$ docker exec -it pipeline_container /bin/bash  
     (you will automatically be put in the /pipeline directory of the container)  
$ python image_receiving.py



### If everything runs successfully (according to the text output of each client), you can look in the *image_database/* directory for the "stored" images, in the *image_event_database/* directory for the image event description text files and associated analysis derivative images, and in the *image_event_alerts/* directory for image event alert description text files.



### <u>Image Event Viewer</u>

An image event viewer allows a user to enter an image event alert number to view the images associated with the alert's image event.  

There are two alternative applications for this: 1) a standalone Python GUI that runs outside of the image pipeline container, or 2) a Python Flask server  (server-side python scripting) that runs inside of its own container. It is connected to by a web browser from outside the container.  

The mock image pipeline is required to have completed successfully the last time the pipeline was run. This results in having the image, image event and image event alert files that the image event viewer needs to function.

**Standalone Python GUI**  

Requires access to the tkinter and Pillow python modules. The mock image pipeline and its container do not have to be currently running. From the image pipeline's main directory (where its *.py files are), run the following command:  

$ python image_event_viewer.py  

**Python Flask Server for Webpages**

Set up the Python Flask container that will run Flask's development web server. The following command is in the *image_event_viewer_webpage/* subdirectory of the image pipeline main application directory.  

$ ./set_up_flask_container.sh  

To see the image event viewer webpage, in a web browser address field enter:  

http://127.0.0.1:8000/

