# Mock Image Pipeline Using Apache Kafka

## <u>Description</u>

This is a mock image processing pipeline using Apache Kafka. It was developed and run on a Linux Mint PC.

It "receives" images, stores them in a "database", analyzes them to detect "image events" of interest, stores descriptions of the events in a "database" and alerts interested parties about them.

It uses python Kafka clients to do the image processing work.  

There are also two standalone (non-Kafka) image event viewer options for entering an image event alert number to see the images associated with the image event.  See the end of this document.

The mock aspects are:  

- The images are not received from an external source. They are generated by the image receiving client.
- The image database is image files in a directory
- The image event database is image event description text files stored in a directory
- The image event alert database is image event alert description text files stored in a directory
- No image event alerts are actually sent



#### Many of the following commands require to be executed in the application's main directory where its Python (*.py) files are.



### Build Apache Kafka image and create a container that automatically runs Apache Kafka

If you've already issued the below docker (pipeline) build/run commands for this project on your system, then you may first need to clean up your Docker environment:  

$ docker stop pipeline_container  
$ docker rm pipeline_container  
$ docker rmi pipeline_image

If you have run this mock application before, you should clear the data directories. You can empty the *image_\**/ directories (except for the image in *image_original/*, which you want to keep) using the following command:  

$ ./clean_image_dirs.sh  

Then build/run the docker image/container. Running the container automatically runs Apache Kafka.

$ docker build -t pipeline_image .  
$ docker run -v \<path where this application's code files are stored>:/pipeline --name pipeline_container -u="root" -p 9092:9092 pipeline_image

### <u>Open a command-line window, enter the container and run the image event alerting Kafka client</u>

Open a command-line window and enter the following commands:  

$ docker exec -it pipeline_container /bin/bash  
     (you will automatically be put in the  /pipeline directory of the container)  
$ python image_event_alert.py

### <u>Open a command-line window, enter the container and run the image analysis Kafka client</u>
Open a command-line window and enter the following commands:  

$ docker exec -it pipeline_container /bin/bash  
     (you will automatically be put in the  /pipeline directory of the container)  
$ python image_analysis.py

### <u>Open a command-line window, enter the container and run the image receiving Kafka client</u>
Open a command-line window and enter the following commands:  

$ docker exec -it pipeline_container /bin/bash  
     (you will automatically be put in the /pipeline directory of the container)  
$ python image_receiving.py



### If everything runs successfully (according to the text output of each client), you can look in the image_database/ directory for the "stored" images, in the image_event_database/ directory for the image event description text files, and in the image_event_alerts/ directory for image event alert description text files.



### <u>Image Event Viewer</u>

An image event viewer allows one to enter an image event alert number to view the images associated with the alert's image event.  

There are two alternative applications for this. 1) a standalone Python GUI that runs outside of the image pipeline container.  2) a web page that runs inside of its own container. It is connected to by a web browser from outside the container.  

The mock image pipeline is required to have completed successfully the last time it was run. This result means there are image, image event and image event alert files that the image event viewer can utilize.

<u>Standalone Python GUI</u>

Requires access to the tkinter and Pillow modules. From the image pipeline's main directory (where its *.py files are), run the following command:  

$ python image_event_viewer.py  

<u>Web Page</u>  

Set up the webpage container. The following command is in the image_event_viewer_webpage/ subdirectory of the image pipeline main application directory.  

$ ./set_up_docker.sh  

In a web browser address field, enter:  

http://127.0.0.1:8000/
